<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoraggio Produzione - Imbriani Noleggio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .monitor-card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease-in-out;
        }
        .monitor-card:hover {
            transform: translateY(-2px);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-online { background-color: #28a745; }
        .status-offline { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .error-log {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            max-height: 300px;
            overflow-y: auto;
            border-radius: 8px;
            padding: 1rem;
        }
        
        .chart-container {
            position: relative;
            height: 200px;
            margin: 1rem 0;
        }
        
        .realtime-indicator {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .network-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">
                    <i class="fas fa-chart-line text-primary me-2"></i>
                    Monitoraggio Produzione - Imbriani Noleggio
                    <span id="realtimeIndicator" class="realtime-indicator text-success">‚óè</span>
                </h1>
                
                <!-- Status Overview -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="metric-card text-center">
                            <div class="stat-item">
                                <span id="overallStatus" class="status-indicator status-online"></span>
                                <span class="stat-value" id="uptimePercentage">99.2%</span>
                                <span class="stat-label">Uptime</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card text-center">
                            <div class="stat-item">
                                <span class="stat-value" id="totalRequests">0</span>
                                <span class="stat-label">Richieste Totali</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card text-center">
                            <div class="stat-item">
                                <span class="stat-value" id="errorRate">0%</span>
                                <span class="stat-label">Tasso Errori</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card text-center">
                            <div class="stat-item">
                                <span class="stat-value" id="avgResponseTime">0ms</span>
                                <span class="stat-label">Tempo Medio</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Network Error Analysis -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="card monitor-card">
                            <div class="card-header">
                                <h5><i class="fas fa-network-wired me-2"></i>Analisi Errori di Rete</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="errorChart"></canvas>
                                </div>
                                <div class="network-stats">
                                    <div class="stat-item">
                                        <span class="stat-value text-danger" id="errAbortedCount">0</span>
                                        <span class="stat-label">ERR_ABORTED</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-value text-warning" id="errFailedCount">0</span>
                                        <span class="stat-label">ERR_FAILED</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-value text-info" id="timeoutCount">0</span>
                                        <span class="stat-label">Timeout</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-value text-secondary" id="corsCount">0</span>
                                        <span class="stat-label">CORS</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card monitor-card">
                            <div class="card-header">
                                <h5><i class="fas fa-shield-alt me-2"></i>Recovery Success Rate</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="recoveryChart"></canvas>
                                </div>
                                <div class="network-stats">
                                    <div class="stat-item">
                                        <span class="stat-value text-success" id="fallbackSuccess">0%</span>
                                        <span class="stat-label">Fallback</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-value text-primary" id="cacheHitRate">0%</span>
                                        <span class="stat-label">Cache Hit</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-value text-warning" id="retrySuccess">0%</span>
                                        <span class="stat-label">Retry Success</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-value text-info" id="offlineHandled">0</span>
                                        <span class="stat-label">Offline Handled</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Real-time Error Log -->
                <div class="card monitor-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-terminal me-2"></i>Log Errori in Tempo Reale</h5>
                        <div>
                            <button class="btn btn-sm btn-outline-primary" onclick="startMonitoring()">
                                <i class="fas fa-play me-1"></i>Avvia Monitoraggio
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="stopMonitoring()">
                                <i class="fas fa-stop me-1"></i>Ferma
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="clearLog()">
                                <i class="fas fa-trash me-1"></i>Pulisci
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="errorLog" class="error-log">
                            <div class="text-muted text-center py-3">
                                <i class="fas fa-info-circle me-2"></i>
                                Monitoraggio in pausa. Clicca "Avvia Monitoraggio" per iniziare.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="row">
                    <div class="col-md-4">
                        <div class="card monitor-card">
                            <div class="card-header">
                                <h6><i class="fas fa-tachometer-alt me-2"></i>Core Web Vitals</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <small class="text-muted">LCP (Largest Contentful Paint)</small>
                                    <div class="progress" style="height: 8px;">
                                        <div id="lcpBar" class="progress-bar bg-success" style="width: 0%"></div>
                                    </div>
                                    <small id="lcpValue" class="text-success">0ms</small>
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted">FID (First Input Delay)</small>
                                    <div class="progress" style="height: 8px;">
                                        <div id="fidBar" class="progress-bar bg-success" style="width: 0%"></div>
                                    </div>
                                    <small id="fidValue" class="text-success">0ms</small>
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted">CLS (Cumulative Layout Shift)</small>
                                    <div class="progress" style="height: 8px;">
                                        <div id="clsBar" class="progress-bar bg-success" style="width: 0%"></div>
                                    </div>
                                    <small id="clsValue" class="text-success">0</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card monitor-card">
                            <div class="card-header">
                                <h6><i class="fas fa-wifi me-2"></i>Network Status</h6>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Status:</span>
                                    <span id="networkStatus" class="badge bg-success">Online</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Connection Type:</span>
                                    <span id="connectionType" class="text-muted">Unknown</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Effective Type:</span>
                                    <span id="effectiveType" class="text-muted">Unknown</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Downlink:</span>
                                    <span id="downlink" class="text-muted">0 Mbps</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card monitor-card">
                            <div class="card-header">
                                <h6><i class="fas fa-cogs me-2"></i>Service Worker</h6>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Status:</span>
                                    <span id="swStatus" class="badge bg-secondary">Checking...</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Cache Hit Rate:</span>
                                    <span id="cacheRate" class="text-muted">0%</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Cached Requests:</span>
                                    <span id="cachedRequests" class="text-muted">0</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Last Update:</span>
                                    <span id="lastUpdate" class="text-muted">Never</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Include shared utils -->
    <script src="shared-utils.js"></script>
    
    <script>
        let monitoringInterval;
        let errorData = {
            errAborted: [],
            errFailed: [],
            timeout: [],
            cors: [],
            timestamps: []
        };
        
        let recoveryData = {
            fallback: [],
            cache: [],
            retry: [],
            offline: [],
            timestamps: []
        };
        
        let metrics = {
            totalRequests: 0,
            successfulRequests: 0,
            failedRequests: 0,
            errorTypes: {
                errAborted: 0,
                errFailed: 0,
                timeout: 0,
                cors: 0
            },
            recoveryStats: {
                fallbackSuccess: 0,
                fallbackAttempts: 0,
                cacheHits: 0,
                cacheAttempts: 0,
                retrySuccess: 0,
                retryAttempts: 0,
                offlineHandled: 0
            },
            responseTimes: [],
            startTime: Date.now()
        };

        // Initialize charts
        const errorCtx = document.getElementById('errorChart').getContext('2d');
        const recoveryCtx = document.getElementById('recoveryChart').getContext('2d');
        
        const errorChart = new Chart(errorCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'ERR_ABORTED',
                        data: [],
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'ERR_FAILED',
                        data: [],
                        borderColor: '#ffc107',
                        backgroundColor: 'rgba(255, 193, 7, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Timeout',
                        data: [],
                        borderColor: '#17a2b8',
                        backgroundColor: 'rgba(23, 162, 184, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'CORS',
                        data: [],
                        borderColor: '#6c757d',
                        backgroundColor: 'rgba(108, 117, 125, 0.1)',
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        
        const recoveryChart = new Chart(recoveryCtx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Fallback Success Rate (%)',
                        data: [],
                        backgroundColor: 'rgba(40, 167, 69, 0.8)',
                        borderColor: '#28a745',
                        borderWidth: 1
                    },
                    {
                        label: 'Cache Hit Rate (%)',
                        data: [],
                        backgroundColor: 'rgba(23, 162, 184, 0.8)',
                        borderColor: '#17a2b8',
                        borderWidth: 1
                    },
                    {
                        label: 'Retry Success Rate (%)',
                        data: [],
                        backgroundColor: 'rgba(255, 193, 7, 0.8)',
                        borderColor: '#ffc107',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });

        // Monitor network errors by intercepting console errors
        function interceptConsoleErrors() {
            const originalError = console.error;
            console.error = function(...args) {
                originalError.apply(console, args);
                
                const errorMessage = args.join(' ');
                if (errorMessage.includes('ERR_ABORTED')) {
                    metrics.errorTypes.errAborted++;
                    logError('ERR_ABORTED', errorMessage);
                } else if (errorMessage.includes('ERR_FAILED')) {
                    metrics.errorTypes.errFailed++;
                    logError('ERR_FAILED', errorMessage);
                } else if (errorMessage.includes('Timeout') || errorMessage.includes('timeout')) {
                    metrics.errorTypes.timeout++;
                    logError('TIMEOUT', errorMessage);
                } else if (errorMessage.includes('CORS') || errorMessage.includes('cors')) {
                    metrics.errorTypes.cors++;
                    logError('CORS', errorMessage);
                }
            };
        }

        // Log errors to the dashboard
        function logError(type, message) {
            const timestamp = new Date().toLocaleTimeString('it-IT');
            const logContainer = document.getElementById('errorLog');
            
            if (logContainer.querySelector('.text-muted')) {
                logContainer.innerHTML = '';
            }
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="text-muted">[${timestamp}]</span>
                <span class="text-${getErrorColor(type)}">${type}:</span>
                <span class="text-light">${message}</span>
            `;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            updateMetrics();
        }

        function getErrorColor(type) {
            switch(type) {
                case 'ERR_ABORTED': return 'danger';
                case 'ERR_FAILED': return 'warning';
                case 'TIMEOUT': return 'info';
                case 'CORS': return 'secondary';
                default: return 'light';
            }
        }

        // Update metrics display
        function updateMetrics() {
            const uptime = Math.round(((Date.now() - metrics.startTime) / 1000 / 60) * 100) / 100;
            const errorRate = metrics.totalRequests > 0 ? 
                Math.round((metrics.failedRequests / metrics.totalRequests) * 1000) / 10 : 0;
            const avgResponseTime = metrics.responseTimes.length > 0 ?
                Math.round(metrics.responseTimes.reduce((a, b) => a + b, 0) / metrics.responseTimes.length) : 0;
            
            document.getElementById('totalRequests').textContent = metrics.totalRequests;
            document.getElementById('errorRate').textContent = `${errorRate}%`;
            document.getElementById('avgResponseTime').textContent = `${avgResponseTime}ms`;
            document.getElementById('errAbortedCount').textContent = metrics.errorTypes.errAborted;
            document.getElementById('errFailedCount').textContent = metrics.errorTypes.errFailed;
            document.getElementById('timeoutCount').textContent = metrics.errorTypes.timeout;
            document.getElementById('corsCount').textContent = metrics.errorTypes.cors;
            
            // Update recovery stats
            const fallbackRate = metrics.recoveryStats.fallbackAttempts > 0 ?
                Math.round((metrics.recoveryStats.fallbackSuccess / metrics.recoveryStats.fallbackAttempts) * 100) : 0;
            const cacheRate = metrics.recoveryStats.cacheAttempts > 0 ?
                Math.round((metrics.recoveryStats.cacheHits / metrics.recoveryStats.cacheAttempts) * 100) : 0;
            const retryRate = metrics.recoveryStats.retryAttempts > 0 ?
                Math.round((metrics.recoveryStats.retrySuccess / metrics.recoveryStats.retryAttempts) * 100) : 0;
            
            document.getElementById('fallbackSuccess').textContent = `${fallbackRate}%`;
            document.getElementById('cacheHitRate').textContent = `${cacheRate}%`;
            document.getElementById('retrySuccess').textContent = `${retryRate}%`;
            document.getElementById('offlineHandled').textContent = metrics.recoveryStats.offlineHandled;
            
            updateCharts();
        }

        // Update charts with new data
        function updateCharts() {
            const now = new Date().toLocaleTimeString('it-IT');
            
            // Update error chart
            if (errorChart.data.labels.length > 20) {
                errorChart.data.labels.shift();
                errorChart.data.datasets.forEach(dataset => dataset.data.shift());
            }
            
            errorChart.data.labels.push(now);
            errorChart.data.datasets[0].data.push(metrics.errorTypes.errAborted);
            errorChart.data.datasets[1].data.push(metrics.errorTypes.errFailed);
            errorChart.data.datasets[2].data.push(metrics.errorTypes.timeout);
            errorChart.data.datasets[3].data.push(metrics.errorTypes.cors);
            errorChart.update();
            
            // Update recovery chart
            if (recoveryChart.data.labels.length > 20) {
                recoveryChart.data.labels.shift();
                recoveryChart.data.datasets.forEach(dataset => dataset.data.shift());
            }
            
            const fallbackRate = metrics.recoveryStats.fallbackAttempts > 0 ?
                Math.round((metrics.recoveryStats.fallbackSuccess / metrics.recoveryStats.fallbackAttempts) * 100) : 0;
            const cacheRate = metrics.recoveryStats.cacheAttempts > 0 ?
                Math.round((metrics.recoveryStats.cacheHits / metrics.recoveryStats.cacheAttempts) * 100) : 0;
            const retryRate = metrics.recoveryStats.retryAttempts > 0 ?
                Math.round((metrics.recoveryStats.retrySuccess / metrics.recoveryStats.retryAttempts) * 100) : 0;
            
            recoveryChart.data.labels.push(now);
            recoveryChart.data.datasets[0].data.push(fallbackRate);
            recoveryChart.data.datasets[1].data.push(cacheRate);
            recoveryChart.data.datasets[2].data.push(retryRate);
            recoveryChart.update();
        }

        // Monitor network status
        function updateNetworkStatus() {
            const isOnline = navigator.onLine;
            const statusEl = document.getElementById('networkStatus');
            const overallStatusEl = document.getElementById('overallStatus');
            
            if (isOnline) {
                statusEl.className = 'badge bg-success';
                statusEl.textContent = 'Online';
                overallStatusEl.className = 'status-indicator status-online';
            } else {
                statusEl.className = 'badge bg-danger';
                statusEl.textContent = 'Offline';
                overallStatusEl.className = 'status-indicator status-offline';
            }
            
            // Update connection info
            if ('connection' in navigator) {
                const connection = navigator.connection;
                document.getElementById('connectionType').textContent = connection.type || 'Unknown';
                document.getElementById('effectiveType').textContent = connection.effectiveType || 'Unknown';
                document.getElementById('downlink').textContent = `${connection.downlink || 0} Mbps`;
            }
        }

        // Monitor service worker
        async function updateServiceWorkerStatus() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    const statusEl = document.getElementById('swStatus');
                    
                    if (registration && registration.active) {
                        statusEl.className = 'badge bg-success';
                        statusEl.textContent = 'Active';
                    } else {
                        statusEl.className = 'badge bg-secondary';
                        statusEl.textContent = 'Inactive';
                    }
                } catch (error) {
                    console.error('Service Worker check failed:', error);
                }
            }
        }

        // Monitor Core Web Vitals
        function monitorWebVitals() {
            // LCP (Largest Contentful Paint)
            new PerformanceObserver((entryList) => {
                for (const entry of entryList.getEntries()) {
                    const lcp = Math.round(entry.startTime);
                    const lcpBar = document.getElementById('lcpBar');
                    const lcpValue = document.getElementById('lcpValue');
                    
                    lcpValue.textContent = `${lcp}ms`;
                    
                    if (lcp < 2500) {
                        lcpBar.className = 'progress-bar bg-success';
                        lcpBar.style.width = '100%';
                    } else if (lcp < 4000) {
                        lcpBar.className = 'progress-bar bg-warning';
                        lcpBar.style.width = '75%';
                    } else {
                        lcpBar.className = 'progress-bar bg-danger';
                        lcpBar.style.width = '100%';
                    }
                }
            }).observe({ entryTypes: ['largest-contentful-paint'] });
            
            // FID (First Input Delay)
            new PerformanceObserver((entryList) => {
                for (const entry of entryList.getEntries()) {
                    const fid = Math.round(entry.processingStart - entry.startTime);
                    const fidBar = document.getElementById('fidBar');
                    const fidValue = document.getElementById('fidValue');
                    
                    fidValue.textContent = `${fid}ms`;
                    
                    if (fid < 100) {
                        fidBar.className = 'progress-bar bg-success';
                        fidBar.style.width = '100%';
                    } else if (fid < 300) {
                        fidBar.className = 'progress-bar bg-warning';
                        fidBar.style.width = '75%';
                    } else {
                        fidBar.className = 'progress-bar bg-danger';
                        fidBar.style.width = '100%';
                    }
                }
            }).observe({ entryTypes: ['first-input'] });
            
            // CLS (Cumulative Layout Shift)
            let clsValue = 0;
            new PerformanceObserver((entryList) => {
                for (const entry of entryList.getEntries()) {
                    if (!entry.hadRecentInput) {
                        clsValue += entry.value;
                    }
                }
                
                const clsBar = document.getElementById('clsBar');
                const clsValueEl = document.getElementById('clsValue');
                
                clsValueEl.textContent = clsValue.toFixed(3);
                
                if (clsValue < 0.1) {
                    clsBar.className = 'progress-bar bg-success';
                    clsBar.style.width = '100%';
                } else if (clsValue < 0.25) {
                    clsBar.className = 'progress-bar bg-warning';
                    clsBar.style.width = '75%';
                } else {
                    clsBar.className = 'progress-bar bg-danger';
                    clsBar.style.width = '100%';
                }
            }).observe({ entryTypes: ['layout-shift'] });
        }

        // Start monitoring
        function startMonitoring() {
            if (monitoringInterval) return;
            
            logError('SYSTEM', 'Monitoraggio avviato - osservazione errori di rete in corso...');
            
            monitoringInterval = setInterval(() => {
                updateNetworkStatus();
                updateServiceWorkerStatus();
                
                // Simulate some monitoring activity
                metrics.totalRequests += Math.floor(Math.random() * 5);
                
                // Randomly simulate some errors for testing
                if (Math.random() < 0.1) { // 10% chance of error
                    const errorTypes = ['ERR_ABORTED', 'ERR_FAILED', 'TIMEOUT', 'CORS'];
                    const randomError = errorTypes[Math.floor(Math.random() * errorTypes.length)];
                    logError(randomError, `Simulated ${randomError} error for testing`);
                }
                
                updateMetrics();
            }, 2000);
            
            document.getElementById('realtimeIndicator').classList.add('realtime-indicator');
        }

        // Stop monitoring
        function stopMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
                logError('SYSTEM', 'Monitoraggio fermato');
                document.getElementById('realtimeIndicator').classList.remove('realtime-indicator');
            }
        }

        // Clear log
        function clearLog() {
            document.getElementById('errorLog').innerHTML = `
                <div class="text-muted text-center py-3">
                    <i class="fas fa-info-circle me-2"></i>
                    Log pulito. Il monitoraggio riprender√† con i prossimi errori.
                </div>
            `;
        }

        // Initialize monitoring
        document.addEventListener('DOMContentLoaded', function() {
            interceptConsoleErrors();
            updateNetworkStatus();
            updateServiceWorkerStatus();
            monitorWebVitals();
            
            // Start monitoring automatically
            setTimeout(startMonitoring, 1000);
            
            console.log('üéØ Dashboard di monitoraggio produzione inizializzata');
            console.log('üìä Osservazione errori di rete in corso...');
            console.log('üîç Produzione: https://xdren98.github.io/');
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            stopMonitoring();
        });
    </script>
</body>
</html>